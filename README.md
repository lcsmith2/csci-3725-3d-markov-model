# CSCI 3725: Markov City
This repository contains a script for a Markov City System. It generates a "city" of the specified size and uses one Markov model to determine the heights and number of sides on each building and another to set the color of the building that is created. It also has a folder with some examples that were generated by the script with various Markov models and parameter values. 
<br />
<br />

## Running The Script
The script is run inside Blender to generate a scene. To run it, open Blender and go to the text editor. Within the text editor,
open the script that was downloaded from this repository. Then, click the run script button. The city should have been added to the scene, and it can be viewed in the 3D Viewport.
<br />
<br />

## Reflection
This system combines two of my interests. I really enjoy world building and think that creating maps is interesting. In addition, I have done some 3D modeling projects in the past that I found fun with various programs including Blender. It is neat to use Blender in a different way by creating models through scripts. I suppose that this system has some practical applications. Although the current implementation produces a fairly simple result where the main differences between buildings are their shape and height, the system could be used to create a city that is used in a game or some other type of software. Using a Markov model to determine the heights and number of faces on the buildings allows for the generation to be guided in some way. For example, there could be a higher probability of buildings being short compared to tall to create more of a suburban feel.
<br />
<br />

This project provided a new challenge for me. I decided to write a program that creates 3D visual art with the help of a Markov model. After some research, I chose to use Blender to render the result. Therefore, the program is a script written in Python that can be run in Blender to create the art. I had never used the blenderpy module before and had to refer to documentation to figure out how to get the code to produce the output I wanted. In addition, although I have used Blender before, I do not have much experience with it and had to relearn how to navigate the program to get the images of the city to render properly. This challenge is important to me because it allowed me to learn a new skill that could be useful in the future. If I want to complete another project using Blender or 3D models, I would have a better idea of how to approach it. Going forward, I will continue to write clean code and look for other opportunities to learn new programs or techniques that can be used for projects.
<br />
<br />

According to the partial definition in class, to be considered creative, a system must be novel and valuable. Based on this definition, I do not believe that my system is creative. It is not novel since many other softwares already exist that generate 3D cities. ([Here](https://www.esri.com/en-us/arcgis/products/arcgis-cityengine/overview) is one example.) Even if they do not use Markov models to create the result, the final product is extremely similar conceptually. Furthermore, I would not say that my system is very valuable in its current state. The buildings are all abstract and the cities lack detail. However, I think that a more complete version of this system that is more realistic and creates cities with more character could be useful for city planning or some other purpose. 
<br />
<br />

## Documentation
The `markov_city.py` file contains everything that is needed to run the script in Blender. It contains the `MarkovCity` class, which contains the Markov models and methods for creating the city with them. The file also has a `main()` function. This is 
where Markov models and a `MarkovCity` object are initialized and the instance is called to create a city. 

The constructor for the `MarkovCity` class has the following parameters (all are required):
* height_transition_matrix (dict): height transition probabilities for the Markov model 
* height_prior_vector (dict): the initial state vector for heights
* color_transition_matrix (dict): color transition probabilities for the Markov model
* color_prior_vector (dict): the initial state vector for color
<br />

The Markov Models section contains more details about these parameters.
<br />

The `create_city()` method has the following parameters:
<br />
* Required
    - base_size (int): the width (and height) of the square city base
* Optional
    - cell_width (int): the width of each square cell within the grid (default value is 10)
    - height_scale_factor (float): the factor each building height will be scaled by (default value is 2.5)

These parameters serve as an additional way to modify the way the city is generated even when using the same Markov models. It is
recommended to keep the `base_size` relatively small (less than 200) since the script can take a long time to run for larger cities. The `PADDING_FACTOR`, `HEIGHT_FACTOR_FOR_COLOR_SHADE`, and `BASE_COLOR` class constants can also be modified to change the padding between each building, the influence of height on color shade, and the base color respectively.
<br />
<br />

### Markov Models
There are two Markov models that are required for generating a city: one for heights and another for color. Each Markov model has a prior vector for the probability of the initial state and a transition matrix. The prior vectors are dictionaries where each key corresponds to an initial state. The transition matrices are dictionaries where each key that corresponds to a state contains another dictionary with the same keys as the outer dictionary. Examples of each will be provided below.
<br />
<br />
The keys for the `height_prior_vector` and `height_transition_matrix` are of type float. Below are examples of each:
```
height_prior_vector = {0: 0.25, 1: 0.25, 2: 0.25, 3: 0.25}

height_transition_matrix = {
    0: {0: 0.25, 1: 0.25, 2: 0.25, 3: 0.25},
    1: {0: 0.25, 1: 0.25, 2: 0.25, 3: 0.25},
    2: {0: 0.25, 1: 0.25, 2: 0.25, 3: 0.25},
    3: {0: 0.25, 1: 0.25, 2: 0.25, 3: 0.25}
}
```
For the `height_transition_matrix`, the value of `height_transition_matrix[0][1] = 0.25` means that there is a probability of 0.25 for the next building height to be 1 if the current one is 0.
<br />
<br />
The keys for the `colors_prior_vector` and `colors_transition_matrix` represent an RGB value are of type tuple. Each tuple contains three float values corresponding to that are between 0 and 1. See below for an example of each.
```
color_prior_vector = {(1, 0, 0): 0.3, (0, 1, 0): 0.4, (0, 0, 1): 0.3}

color_transition_matrix = {
        (1, 0, 0): {(1, 0, 0): 0.3, (0, 1, 0): 0.4, (0, 0, 1): 0.3},
        (0, 1, 0): {(1, 0, 0): 0.3, (0, 1, 0): 0.4, (0, 0, 1): 0.3},
        (0, 0, 1): {(1, 0, 0): 0.3, (0, 1, 0): 0.4, (0, 0, 1): 0.3}
    }
```
For the `colors`, the value of `color_transition_matrix[0][1] = 0.3` means that there is a probability of 0.3 for the next building color to have RGB value (0, 1, 0) (the color blue) if the current one has RGB value (1, 0, 0) (the color red).
<br />
<br />
Note in these examples how for each row in the transition matrix and each value for the prior vector, all values sum to 1. This must always be the case. Otherwise, an exception will occur.
<br />
<br />

## Sources
https://docs.blender.org/api/current/index.html
<br />
https://k3no.medium.com/the-basics-of-using-python-in-blender-46831fd094e6


